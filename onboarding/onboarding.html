<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Infinity - Onboarding</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f7;
            color: #1d1d1f;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 600;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .onboarding-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .step-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            display: none;
        }
        
        .step-card.active {
            display: block;
        }
        
        .step-header {
            margin-bottom: 20px;
        }
        
        .step-number {
            color: #667eea;
            font-size: 0.9em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .step-title {
            font-size: 1.8em;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .step-description {
            color: #666;
            font-size: 1.1em;
            line-height: 1.5;
            margin-bottom: 20px;
        }
        
        .reassurance-box {
            background: #f0f8ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .reassurance-box h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 1.1em;
        }
        
        .reassurance-box p {
            margin: 0;
            color: #555;
            font-size: 0.95em;
        }
        
        .compliance-badges {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .badge {
            background: #e8f4fd;
            color: #0066cc;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .btn.secondary {
            background: #6c757d;
        }
        
        .btn.secondary:hover {
            background: #5a6268;
        }
        
        .btn.success {
            background: #28a745;
        }
        
        .btn.success:hover {
            background: #218838;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input[type="text"],
        .form-group input[type="url"],
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            box-sizing: border-box;
        }
        
        .form-group input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 6px;
            text-align: center;
            background: #f9f9f9;
        }
        
        .progress-bar {
            background: #e9ecef;
            height: 6px;
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }
        
        .connector-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .connector-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .connector-card:hover {
            border-color: #667eea;
            background: #f0f8ff;
        }
        
        .connector-card.connected {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .connector-logo {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .connector-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .connector-status {
            font-size: 0.85em;
            color: #666;
        }
        
        .chat-interface {
            background: white;
            border-radius: 12px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .chat-header {
            background: #667eea;
            color: white;
            padding: 15px;
            font-weight: 500;
        }
        
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .message {
            margin-bottom: 15px;
        }
        
        .message.agent {
            text-align: left;
        }
        
        .message.user {
            text-align: right;
        }
        
        .message-bubble {
            display: inline-block;
            padding: 10px 15px;
            border-radius: 12px;
            max-width: 70%;
        }
        
        .message.agent .message-bubble {
            background: #f1f3f4;
            color: #333;
        }
        
        .message.user .message-bubble {
            background: #667eea;
            color: white;
        }
        
        .chat-input-container {
            padding: 15px;
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
        }
        
        .hidden {
            display: none !important;
        }
        
        .step-actions {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .step-card {
                padding: 20px;
            }
            
            .connector-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü§ñ Business Infinity</h1>
        <p>Welcome to your perpetual boardroom</p>
    </div>

    <div class="onboarding-container">
        <div class="progress-bar">
            <div class="progress-fill" style="width: 10%"></div>
        </div>

        <!-- Step 1: Welcome Gateway -->
        <div class="step-card active" id="step-1">
            <div class="step-header">
                <div class="step-number">Step 1 of 10</div>
                <div class="step-title">Welcome Gateway</div>
                <div class="step-description">
                    Welcome ‚Äî this is your private boardroom. We'll only read data you allow and never change anything without permission.
                </div>
            </div>

            <div class="reassurance-box">
                <h4>üîí Your Security & Privacy</h4>
                <p>Read-only connections by default; you remain in control. We follow industry best practices.</p>
            </div>

            <div class="compliance-badges">
                <span class="badge">üõ°Ô∏è OAuth Secure Sign-On</span>
                <span class="badge">üìã Security & Compliance</span>
            </div>

            <div class="form-group">
                <label for="company-name">Company Name (auto-detected if available):</label>
                <input type="text" id="company-name" placeholder="Enter your company name">
            </div>

            <div class="step-actions">
                <button class="btn" onclick="continueWithLinkedIn()">Continue with LinkedIn</button>
                <button class="btn secondary" onclick="continueWithEmail()">Continue with Email</button>
            </div>
        </div>

        <!-- Step 2: LinkedIn Identity Capture -->
        <div class="step-card" id="step-2">
            <div class="step-header">
                <div class="step-number">Step 2 of 10</div>
                <div class="step-title">LinkedIn Identity Capture</div>
                <div class="step-description">
                    We'll read your profile and recent public posts to tailor the boardroom voice. Nothing will be posted or changed.
                </div>
            </div>

            <div class="reassurance-box">
                <h4>üìñ What We'll Read</h4>
                <p>Only core profile + last 20 public posts are used. You can revoke access anytime.</p>
            </div>

            <div class="compliance-badges">
                <span class="badge">‚úÖ Consent Logged</span>
                <span class="badge">üìä Data Minimization</span>
            </div>

            <div id="linkedin-auth-loading" class="loading hidden">
                Connecting to LinkedIn...
            </div>

            <div class="step-actions">
                <button class="btn" onclick="authorizeLinkedIn()">Authorize LinkedIn Access</button>
                <button class="btn secondary" onclick="skipStep()">Skip This Step</button>
            </div>
        </div>

        <!-- Step 3: Website Auto-discovery -->
        <div class="step-card" id="step-3">
            <div class="step-header">
                <div class="step-number">Step 3 of 10</div>
                <div class="step-title">Website & Public Content Discovery</div>
                <div class="step-description">
                    We only fetch public content; we will ask before you upload any private documents.
                </div>
            </div>

            <div class="reassurance-box">
                <h4>üåê Public Content Only</h4>
                <p>This was read from your public site; no writes occurred. Everything is logged and auditable.</p>
            </div>

            <div class="compliance-badges">
                <span class="badge">üìù Source Attribution</span>
                <span class="badge">üëÅÔ∏è Read-Only Mode</span>
            </div>

            <div class="form-group">
                <label for="website-url">Company Website URL:</label>
                <input type="url" id="website-url" placeholder="https://your-company.com">
            </div>

            <div id="website-preview" class="hidden">
                <h4>Website Preview:</h4>
                <p>Does this represent your company correctly?</p>
                <div id="parsed-content"></div>
            </div>

            <div class="step-actions">
                <button class="btn" onclick="parseWebsite()">Parse Website</button>
                <button class="btn secondary" onclick="nextStep()">Skip Website</button>
            </div>
        </div>

        <!-- Step 4: Pitch Deck Upload -->
        <div class="step-card" id="step-4">
            <div class="step-header">
                <div class="step-number">Step 4 of 10</div>
                <div class="step-title">Pitch Deck Upload</div>
                <div class="step-description">
                    Upload your deck to make onboarding faster. Files are stored encrypted and only accessible in read-only mode to boardroom agents.
                </div>
            </div>

            <div class="reassurance-box">
                <h4>üîê File Security</h4>
                <p>Stored encrypted at rest (AES-256 equivalent). Only authorized boardroom agents can read this file; audit log available.</p>
            </div>

            <div class="compliance-badges">
                <span class="badge">üîë AES-256 Encryption</span>
                <span class="badge">üìã Audit Trail</span>
                <span class="badge">üë• Access Control</span>
            </div>

            <div class="form-group">
                <label for="pitch-deck">Upload Pitch Deck (PDF, PPT):</label>
                <input type="file" id="pitch-deck" accept=".pdf,.ppt,.pptx" onchange="handleFileUpload(this)">
            </div>

            <div class="step-actions">
                <button class="btn" onclick="processDeck()">Upload & Process Deck</button>
                <button class="btn secondary" onclick="nextStep()">I'd rather not upload now</button>
            </div>
        </div>

        <!-- Step 5: Financial Documents -->
        <div class="step-card" id="step-5">
            <div class="step-header">
                <div class="step-number">Step 5 of 10</div>
                <div class="step-title">Financial Documents & Reports</div>
                <div class="step-description">
                    Public filings are powerful anchors. We will never alter these documents ‚Äî only read and summarize.
                </div>
            </div>

            <div class="reassurance-box">
                <h4>üìä Document Integrity</h4>
                <p>Private files retained 30 days by default; export or delete anytime. Files are hashed to verify unchanged content.</p>
            </div>

            <div class="compliance-badges">
                <span class="badge">üîó Chain of Custody</span>
                <span class="badge">‚è±Ô∏è Retention Policy</span>
            </div>

            <div class="form-group">
                <label for="financial-docs">Upload Annual Reports or Financial Documents:</label>
                <input type="file" id="financial-docs" accept=".pdf" multiple onchange="handleFileUpload(this)">
            </div>

            <div class="step-actions">
                <button class="btn" onclick="processFinancials()">Upload Documents</button>
                <button class="btn secondary" onclick="nextStep()">Skip Financial Documents</button>
            </div>
        </div>

        <!-- Step 6: System Connectors -->
        <div class="step-card" id="step-6">
            <div class="step-header">
                <div class="step-number">Step 6 of 10</div>
                <div class="step-title">Connect Core Systems</div>
                <div class="step-description">
                    Connect systems in read-only mode so the boardroom can advise using live data. You can revoke access anytime.
                </div>
            </div>

            <div class="reassurance-box">
                <h4>üîê Read-Only Access</h4>
                <p>We request read-only scope only. No writes or edits. Connections use TLS; tokens are stored encrypted.</p>
            </div>

            <div class="compliance-badges">
                <span class="badge">üîí TLS Encryption</span>
                <span class="badge">üëÅÔ∏è Read-Only OAuth</span>
                <span class="badge">üõ°Ô∏è Pen Testing</span>
            </div>

            <div class="connector-grid">
                <div class="connector-card" onclick="connectSystem('salesforce')">
                    <div class="connector-logo">‚ö°</div>
                    <div class="connector-name">Salesforce</div>
                    <div class="connector-status">Read: Opportunities, Accounts, Contacts</div>
                </div>
                <div class="connector-card" onclick="connectSystem('hubspot')">
                    <div class="connector-logo">üü†</div>
                    <div class="connector-name">HubSpot</div>
                    <div class="connector-status">Read: Deals, Companies, Contacts</div>
                </div>
                <div class="connector-card" onclick="connectSystem('netsuite')">
                    <div class="connector-logo">üíº</div>
                    <div class="connector-name">NetSuite</div>
                    <div class="connector-status">Read: Financials, Customers</div>
                </div>
                <div class="connector-card" onclick="connectSystem('workday')">
                    <div class="connector-logo">üë•</div>
                    <div class="connector-name">Workday</div>
                    <div class="connector-status">Read: Employee Data, Payroll</div>
                </div>
                <div class="connector-card" onclick="connectSystem('quickbooks')">
                    <div class="connector-logo">üìä</div>
                    <div class="connector-name">QuickBooks</div>
                    <div class="connector-status">Read: Accounts, Transactions</div>
                </div>
                <div class="connector-card" onclick="connectSystem('slack')">
                    <div class="connector-logo">üí¨</div>
                    <div class="connector-name">Slack</div>
                    <div class="connector-status">Read: Public Channels</div>
                </div>
            </div>

            <div class="step-actions">
                <button class="btn" onclick="nextStep()">Continue to Next Step</button>
                <button class="btn secondary" onclick="quickBaseline()">Quick Baseline (Website + Deck Only)</button>
            </div>
        </div>

        <!-- Step 7: Voice Profile -->
        <div class="step-card" id="step-7">
            <div class="step-header">
                <div class="step-number">Step 7 of 10</div>
                <div class="step-title">Voice Profile Creation</div>
                <div class="step-description">
                    We only analyze public posts to learn voice and priorities ‚Äî nothing is published anywhere.
                </div>
            </div>

            <div class="reassurance-box">
                <h4>üó£Ô∏è Voice Analysis</h4>
                <p>Transparency log shows the posts parsed and you can remove any post from analysis.</p>
            </div>

            <div id="voice-preview" class="hidden">
                <h4>Voice Profile Preview:</h4>
                <div id="voice-themes"></div>
                <button class="btn secondary" onclick="editVoiceProfile()">Edit Voice Profile</button>
            </div>

            <div class="step-actions">
                <button class="btn" onclick="generateVoiceProfile()">Generate Voice Profile</button>
                <button class="btn secondary" onclick="nextStep()">Skip Voice Analysis</button>
            </div>
        </div>

        <!-- Step 8: Instant Baseline -->
        <div class="step-card" id="step-8">
            <div class="step-header">
                <div class="step-number">Step 8 of 10</div>
                <div class="step-title">Instant Founder Dossier & Baseline</div>
                <div class="step-description">
                    Your boardroom is assembled. We've created your Founder Dossier and Company Brief. From here on, we observe and advise; nothing will be changed without your permission.
                </div>
            </div>

            <div class="reassurance-box">
                <h4>üìã Audit & Control</h4>
                <p>Everything is logged and auditable. You can download artifacts or request deletion; clear SLA for deletion.</p>
            </div>

            <div class="compliance-badges">
                <span class="badge">üìú Audit Trail</span>
                <span class="badge">üì• Data Export</span>
                <span class="badge">üóëÔ∏è Data Deletion</span>
            </div>

            <!-- Chat interface for CEO agent -->
            <div class="chat-interface">
                <div class="chat-header">
                    ü§µ CEO Agent - Initial Briefing
                </div>
                <div class="chat-messages" id="ceo-chat">
                    <!-- Messages will be added here -->
                </div>
            </div>

            <div class="step-actions">
                <button class="btn" onclick="viewAuditTrail()">View Audit Trail</button>
                <button class="btn" onclick="inviteTeam()">Invite Co-founder/Legal Counsel</button>
                <button class="btn success" onclick="nextStep()">Continue</button>
            </div>
        </div>

        <!-- Step 9: Governance & Privacy -->
        <div class="step-card" id="step-9">
            <div class="step-header">
                <div class="step-number">Step 9 of 10</div>
                <div class="step-title">Governance & Privacy Settings</div>
                <div class="step-description">
                    By default your data is private to you. Invite team members selectively. You can change these settings any time.
                </div>
            </div>

            <div class="reassurance-box">
                <h4>üõ°Ô∏è Role-Based Access Control</h4>
                <p>Conservative defaults: founder only, read-only for invited viewers; notification cadence = weekly.</p>
            </div>

            <div class="form-group">
                <label for="notification-frequency">Notification Frequency:</label>
                <select id="notification-frequency">
                    <option value="weekly" selected>Weekly</option>
                    <option value="daily">Daily</option>
                    <option value="monthly">Monthly</option>
                </select>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="security-summaries" checked>
                    Receive monthly security summaries
                </label>
            </div>

            <div class="step-actions">
                <button class="btn" onclick="saveGovernanceSettings()">Save Settings</button>
            </div>
        </div>

        <!-- Step 10: Quick Actions -->
        <div class="step-card" id="step-10">
            <div class="step-header">
                <div class="step-number">Step 10 of 10</div>
                <div class="step-title">Welcome to Your Boardroom</div>
                <div class="step-description">
                    You're inside the boardroom. We'll surface weekly insights and urgent risks proactively. When you're ready for a full review, we'll convene. Until then, we watch, learn, and advise.
                </div>
            </div>

            <!-- Final chat interface -->
            <div class="chat-interface">
                <div class="chat-header">
                    ü§µ CEO Agent - Quick Actions
                </div>
                <div class="chat-messages" id="final-chat">
                    <div class="message agent">
                        <div class="message-bubble">
                            Welcome to your perpetual boardroom! I have three suggested quick actions to get started:
                            <br><br>
                            A) Ask CFO to build a runway model<br>
                            B) Ask CMO for a GTM voice brief<br>
                            C) Schedule a deep review (optional)
                        </div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="quick-action-input" placeholder="Type your choice (A, B, C) or ask a question...">
                    <button class="btn" onclick="sendQuickAction()">Send</button>
                </div>
            </div>

            <div class="reassurance-box">
                <h4>üõ°Ô∏è Security & Support</h4>
                <p>From now on we watch, advise, and protect. You invited us in; you can leave anytime. If security or privacy is ever a concern, click Revoke Access or contact security@businessinfinity ‚Äî we'll respond within 4 hours.</p>
            </div>

            <div class="step-actions">
                <button class="btn success" onclick="enterBoardroom()">Enter Boardroom</button>
                <button class="btn secondary" onclick="scheduleLater()">I'll Decide Later</button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let onboardingData = {};
        let connectedSystems = [];

        function updateProgress() {
            const progress = (currentStep / 10) * 100;
            document.querySelector('.progress-fill').style.width = progress + '%';
        }

        function showStep(stepNumber) {
            // Hide all steps
            document.querySelectorAll('.step-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Show current step
            document.getElementById('step-' + stepNumber).classList.add('active');
            currentStep = stepNumber;
            updateProgress();
        }

        function nextStep() {
            if (currentStep < 10) {
                showStep(currentStep + 1);
            }
        }

        function skipStep() {
            nextStep();
        }

        async function continueWithLinkedIn() {
            onboardingData.authMethod = 'linkedin';
            onboardingData.companyName = document.getElementById('company-name').value;
            nextStep();
        }

        async function continueWithEmail() {
            onboardingData.authMethod = 'email';
            onboardingData.companyName = document.getElementById('company-name').value;
            // Skip LinkedIn step
            showStep(3);
        }

        async function authorizeLinkedIn() {
            document.getElementById('linkedin-auth-loading').classList.remove('hidden');
            
            try {
                // Call LinkedIn OAuth endpoint
                const response = await fetch('/api/linkedin/auth', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ state: 'onboarding' })
                });
                
                const result = await response.json();
                if (result.login_url) {
                    window.location.href = result.login_url;
                }
            } catch (error) {
                console.error('LinkedIn auth error:', error);
                alert('LinkedIn authentication failed. Please try again.');
            }
            
            document.getElementById('linkedin-auth-loading').classList.add('hidden');
        }

        async function parseWebsite() {
            const websiteUrl = document.getElementById('website-url').value;
            if (!websiteUrl) {
                alert('Please enter a website URL');
                return;
            }

            try {
                const response = await fetch('/api/onboarding/parse-website', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: websiteUrl })
                });
                
                const result = await response.json();
                if (result.success) {
                    document.getElementById('website-preview').classList.remove('hidden');
                    document.getElementById('parsed-content').innerHTML = `
                        <p><strong>Company:</strong> ${result.data.company_name || 'Not found'}</p>
                        <p><strong>Tagline:</strong> ${result.data.tagline || 'Not found'}</p>
                        <p><strong>Description:</strong> ${result.data.description || 'Not found'}</p>
                    `;
                    onboardingData.websiteData = result.data;
                }
            } catch (error) {
                console.error('Website parsing error:', error);
                alert('Website parsing failed. Please try again.');
            }
        }

        function handleFileUpload(input) {
            const files = input.files;
            console.log('Files selected:', files.length);
        }

        async function processDeck() {
            const fileInput = document.getElementById('pitch-deck');
            if (!fileInput.files.length) {
                alert('Please select a file to upload');
                return;
            }

            const formData = new FormData();
            formData.append('deck', fileInput.files[0]);

            try {
                const response = await fetch('/api/onboarding/upload-deck', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                if (result.success) {
                    onboardingData.deckData = result.data;
                    alert('Deck uploaded and processed successfully!');
                    nextStep();
                }
            } catch (error) {
                console.error('Deck upload error:', error);
                alert('Deck upload failed. Please try again.');
            }
        }

        async function processFinancials() {
            const fileInput = document.getElementById('financial-docs');
            if (!fileInput.files.length) {
                alert('Please select files to upload');
                return;
            }

            const formData = new FormData();
            Array.from(fileInput.files).forEach(file => {
                formData.append('financials', file);
            });

            try {
                const response = await fetch('/api/onboarding/upload-financials', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                if (result.success) {
                    onboardingData.financialData = result.data;
                    alert('Financial documents uploaded successfully!');
                    nextStep();
                }
            } catch (error) {
                console.error('Financial upload error:', error);
                alert('Financial document upload failed. Please try again.');
            }
        }

        async function connectSystem(systemName) {
            try {
                const response = await fetch(`/api/onboarding/connect-system`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ system: systemName })
                });
                
                const result = await response.json();
                if (result.auth_url) {
                    window.open(result.auth_url, '_blank', 'width=600,height=600');
                    // Mark as connected for demo
                    document.querySelector(`[onclick="connectSystem('${systemName}')"]`).classList.add('connected');
                    connectedSystems.push(systemName);
                }
            } catch (error) {
                console.error('System connection error:', error);
                alert('System connection failed. Please try again.');
            }
        }

        function quickBaseline() {
            onboardingData.baselineType = 'quick';
            nextStep();
        }

        async function generateVoiceProfile() {
            try {
                const response = await fetch('/api/onboarding/generate-voice-profile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(onboardingData)
                });
                
                const result = await response.json();
                if (result.success) {
                    document.getElementById('voice-preview').classList.remove('hidden');
                    document.getElementById('voice-themes').innerHTML = `
                        <p><strong>Key Themes:</strong> ${result.data.themes.join(', ')}</p>
                        <p><strong>Tone:</strong> ${result.data.tone}</p>
                        <p><strong>Communication Style:</strong> ${result.data.style}</p>
                    `;
                    onboardingData.voiceProfile = result.data;
                }
            } catch (error) {
                console.error('Voice profile error:', error);
                alert('Voice profile generation failed. Please try again.');
            }
        }

        function editVoiceProfile() {
            alert('Voice profile editing interface would open here');
        }

        async function viewAuditTrail() {
            window.open('/api/onboarding/audit-trail', '_blank');
        }

        function inviteTeam() {
            alert('Team invitation interface would open here');
        }

        function saveGovernanceSettings() {
            const settings = {
                notificationFrequency: document.getElementById('notification-frequency').value,
                securitySummaries: document.getElementById('security-summaries').checked
            };
            onboardingData.governanceSettings = settings;
            nextStep();
        }

        async function sendQuickAction() {
            const input = document.getElementById('quick-action-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage('final-chat', 'user', message);
            input.value = '';
            
            // Send to backend
            try {
                const response = await fetch('/api/onboarding/quick-action', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, onboardingData })
                });
                
                const result = await response.json();
                if (result.success) {
                    addChatMessage('final-chat', 'agent', result.response);
                }
            } catch (error) {
                console.error('Quick action error:', error);
                addChatMessage('final-chat', 'agent', 'I apologize, but I encountered an error. Please try again.');
            }
        }

        function addChatMessage(chatId, sender, message) {
            const chatMessages = document.getElementById(chatId);
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.innerHTML = message;
            
            messageDiv.appendChild(bubbleDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function enterBoardroom() {
            // Save final onboarding data
            localStorage.setItem('onboardingCompleted', 'true');
            localStorage.setItem('onboardingData', JSON.stringify(onboardingData));
            
            // Redirect to main boardroom interface
            window.location.href = '/conversations/dashboard.html';
        }

        function scheduleLater() {
            // Mark onboarding as deferred
            localStorage.setItem('onboardingDeferred', 'true');
            window.location.href = '/conversations/dashboard.html';
        }

        // Initialize CEO chat message for step 8
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                addChatMessage('ceo-chat', 'agent', 'Your Founder Dossier and Live Baseline are ready. No writes were made. Everything is logged and auditable. Your boardroom is now assembled and ready to provide strategic guidance.');
            }, 1000);
        });

        // Handle browser back/forward
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.step) {
                showStep(event.state.step);
            }
        });

        // Push initial state
        history.pushState({step: 1}, '', '');
    </script>
</body>
</html>